---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Layout/Header.astro';
import Seo from '../../components/Seo.astro';
import Footer from '../../components/Layout/Footer.astro';
import Hero from '../../components/Hero.astro';
import Offers from '../../components/Offers.astro';
import Separator from '../../components/Layout/Separator.astro';
import RatingSection from '../../components/RatingComponent/RatingSection.astro';
import CocktailSection from '../../components/Cocktails/CocktailSection.astro';
import mojitoImg from '../../assets/menu/mojito.webp';
import flag from '../../assets/flags/esp.svg';
import flagP1 from '../../assets/flags/eng.svg';
import flagP2 from '../../assets/flags/fr.svg';
import { locales, translations, defaultLocale } from '../../data/i18n';

export async function getStaticPaths() {
  return locales.map((l) => ({ params: { lang: l } }));
}

const { lang } = Astro.params;
const currentPath = new URL(Astro.request.url).pathname;
const canonical = new URL(Astro.request.url).href;
const t = translations[lang as keyof typeof translations] ?? translations[defaultLocale];

const headerSection = {
  flagImg: flag,
  flagImgP1: flagP1,
  flagImgP2: flagP2,
  currentLang: lang,
  homeTxt: t.home,
  cocktailsTxt: t.cocktails,
  contactTxt: t.contact
};

// sample drinks for the cocktails section (uses optimized asset import)
const drinkss = [
  { id: 'mojito', title: 'Mojito', subtitle: 'Clásico, Mango, Fresa, Frutos Rojos, Maracuyá', types: ['Clásico','Mango','Fresa','Frutos Rojos','Maracuyá'], image: mojitoImg, imageAlt: 'Mojito en vaso', reverse: true, variant: 'mojito' },
  { id: 'pina', title: 'Piña Colada', subtitle: 'Clásico, Mango, Fresa y más', types: ['Clásico','Mango','Fresa','Passion Fruit'], image: mojitoImg, imageAlt: 'Piña colada en vaso', variant: 'pinacolada' }
];

// Build a drinks array for the CocktailSection using the 'cocktails' menu items
const cocktailsSection = t.menu?.sections?.find((s: any) => s.id === 'cocktails');
const drinks = (cocktailsSection?.items ?? []).map((item: any, i: number) => ({
  id: `cocktail-${i}`,
  title: item.name,
  subtitle: item.description,
  types: [item.name],
  image: mojitoImg,
  imageAlt: item.name,
  reverse: false,
  variant: 'cocktail'
}));

---

<Seo title={t.seo.home.title} description={t.seo.home.description} canonical={canonical} lang={lang} business={{
  name: t.siteName,
  description: t.seo.home.description,
  address: t.contactAddress,
  telephone: t.contactPhone,
  email: t.contactEmail,
  openingHours: t.contactHours,
  openingHoursSpecification: t.openingHoursSpecification,
  image: '/assets/logos/koj_logo.png',
  type: 'Bar',
  sameAs: [
    'https://www.instagram.com/kingofjudahreggae/',
    'https://www.tripadvisor.com/Attraction_Review-g187482-d13817854-Reviews-King_Of_Judah_Reggae_Bar-Santa_Cruz_de_Tenerife_Tenerife_Canary_Islands.html',
    'https://www.facebook.com/KingOfJudahTenerife'
  ]
}} />

<Layout lang={lang}>
  <Header flagImg={headerSection.flagImg} flagImgP1={headerSection.flagImgP1} flagImgP2={headerSection.flagImgP2} currentLang={headerSection.currentLang} currentPath={currentPath} homeTxt={headerSection.homeTxt} cocktailsTxt={headerSection.cocktailsTxt} contactTxt={headerSection.contactTxt} />
  <Hero welcomeMsg={t.welcomeMsg} mWords={t.mWords} />
  <Separator />
  <Offers sectionTitle={t.offerTitle} offers={t.offers} />
  <Separator />
  <CocktailSection drinks={drinks} />
  <Separator />
  <RatingSection sectionTitle={t.ratingTitle} />
  <Footer />
</Layout>
