---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Layout/Header.astro';
import Seo from '../../components/Seo.astro';
import Footer from '../../components/Layout/Footer.astro';
import { locales, translations, defaultLocale } from '../../data/i18n';
import flag from '../../assets/flags/esp.svg';
import flagP1 from '../../assets/flags/eng.svg';
import flagP2 from '../../assets/flags/fr.svg';
import mojitoImg from '../../assets/menu/mojito.webp';
import Image from 'astro/components/Image.astro';
import CocktailSection from '../../components/Cocktails/CocktailSection.astro';

export async function getStaticPaths() {
  return locales.map((l) => ({ params: { lang: l } }));
}

const { lang } = Astro.params;
const currentPath = new URL(Astro.request.url).pathname;
const canonical = new URL(Astro.request.url).href;
const t = translations[lang as keyof typeof translations] ?? translations[defaultLocale];

// Build a drinks array for the CocktailSection using the 'cocktails' menu items
const cocktailsSection = t.menu?.sections?.find((s: any) => s.id === 'cocktails');
const drinks = (cocktailsSection?.items ?? []).map((item: any, i: number) => ({
  id: `cocktail-${i}`,
  title: item.name,
  subtitle: item.description,
  types: [item.name],
  image: mojitoImg,
  imageAlt: item.name,
  reverse: false,
  variant: 'cocktail'
}));

---


<Seo title={t.seo.cocktails.title} description={t.seo.cocktails.description} canonical={canonical} lang={lang} business={{
  name: t.siteName,
  description: t.seo.cocktails.description,
  address: t.contactAddress,
  telephone: t.contactPhone,
  email: t.contactEmail,
  openingHours: t.contactHours,
  openingHoursSpecification: t.openingHoursSpecification,
  image: '/assets/logos/koj_logo.png',
  type: 'Bar',
  sameAs: [
    'https://www.instagram.com/kingofjudahreggae/',
    'https://www.tripadvisor.com/Attraction_Review-g187482-d13817854-Reviews-King_Of_Judah_Reggae_Bar-Santa_Cruz_de_Tenerife_Tenerife_Canary_Islands.html',
    'https://www.facebook.com/KingOfJudahTenerife'
  ]
}} />

<Layout lang={lang}>
  <Header flagImg={flag} flagImgP1={flagP1} flagImgP2={flagP2} currentLang={lang} currentPath={currentPath} homeTxt={t.home} cocktailsTxt={t.cocktails} contactTxt={t.contact} />

  <main class=" h-fit bg-linear-to-br from-green-950 via-yellow-900 to-red-900">
    <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold animate-pulse mb-4 py-12 text-center">{t.cocktails}</h1>

    <nav class=" flex gap-2 flex-wrap justify-center">
      {t.menu.sections.map(section => (
        <a class="btn btn-sm" href={`#${section.id}`}>{section.title}</a>
      ))}
    </nav>

    <!-- Render the CocktailSection component first (uses optimized images) -->
    <CocktailSection drinks={drinks} />

    <section class="space-y-8">
      {t.menu.sections.map(section => (
        <div id={section.id} class="card bg-neutral/30 shadow-sm p-4">
          <h2 class="text-2xl font-semibold mb-3">{section.title}</h2>
          {section.id === 'cocktails' ? (
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
              {section.items.map(item => (
                <article class="card bg-neutral/30 shadow-sm p-3 flex flex-col">
                  <div class="p-2 w-full h-60 overflow-hidden rounded mb-3">
                    <Image src={mojitoImg} alt={item.name} class="w-full h-full object-cover rounded" />
                  </div>
                  <div class="flex-1">
                    <h3 class="font-semibold text-lg">{item.name}</h3>
                    <p class="text-sm text-muted mt-1">{item.description}</p>
                  </div>
                  <div class="mt-3 font-medium">{item.price}</div>
                </article>
              ))}
            </div>
          ) : (
            <ul class="space-y-2">
              {section.items.map(item => (
                <li class="flex justify-between items-start">
                  <div>
                    <div class="font-semibold">{item.name}</div>
                    <div class="text-sm text-muted">{item.description}</div>
                  </div>
                  <div class="font-medium ml-4">{item.price}</div>
                </li>
              ))}
            </ul>
          )}
        </div>
      ))}
    </section>
  </main>

  <Footer />
</Layout>

<style>
  section.space-y-8 > .card:nth-child(1) {
    outline: 2px solid #00c81eff; /* green */
  }
  section.space-y-8 > .card:nth-child(2) {
    outline: 2px solid #80ce01ff; /* lime / yellow-green */
  }
  section.space-y-8 > .card:nth-child(3) {
    outline: 2px solid #f0f000ff; 
  }
  section.space-y-8 > .card:nth-child(4) {
    outline: 2px solid #ef8344ff; 
  }
  section.space-y-8 > .card:nth-child(5) {
    outline: 2px solid #dc2626; 
  }

</style>